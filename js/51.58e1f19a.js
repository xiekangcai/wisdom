"use strict";(self["webpackChunkshoppingmobile"]=self["webpackChunkshoppingmobile"]||[]).push([[51],{3051:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"box"},[t("Navbar",{scopedSlots:e._u([{key:"go",fn:function(){return[t("van-icon",{attrs:{name:"arrow-left"}})]},proxy:!0},{key:"title",fn:function(){return[e._v(" 会员登录 ")]},proxy:!0}])}),t("div",{staticClass:"from"},[e._m(0),t("div",{staticClass:"controller"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.mobile,expression:"form.mobile"}],attrs:{type:"text",placeholder:"请输入手机号码"},domProps:{value:e.form.mobile},on:{input:function(t){t.target.composing||e.$set(e.form,"mobile",t.target.value)}}})]),t("div",{staticClass:"border"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.captchaCode,expression:"form.captchaCode"}],attrs:{type:"text",placeholder:"请输入图形验证码"},domProps:{value:e.form.captchaCode},on:{input:function(t){t.target.composing||e.$set(e.form,"captchaCode",t.target.value)}}}),t("img",{attrs:{src:e.imgUrl,alt:""},on:{click:e.changeImgUrl}})]),t("div",{staticClass:"border"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.smsCode,expression:"smsCode"}],attrs:{type:"text",placeholder:"请输入短信验证码"},domProps:{value:e.smsCode},on:{input:function(t){t.target.composing||(e.smsCode=t.target.value)}}}),e.bool?t("span",{on:{click:e.getCaptcha}},[e._v("获取验证码")]):t("span",{staticStyle:{color:"black"},on:{click:function(t){return e.$toast("请等待倒计时完成后发送")}}},[e._v(e._s(e.backNum)+"后重新发送")])])]),t("div",{staticClass:"button"},[t("button",{on:{click:e.login}},[e._v("登录")])])])],1)},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"tips"},[t("h2",[e._v("手机号登录")]),t("p",[e._v("未注册的手机号登录后将自动注册")])])}],r=(s(9704),s(1981)),i=s(7242),n=s(5720);class c{changeImgUrl(){return n.A.get("/captcha/image")}postRq(e,t){return n.A.post(e,t)}login(e){return this.postRq("/passport/login",e)}}var l=new c,m=s(8355);const u=m.A.create({baseURL:"http://smart-shop.itheima.net/index.php?s=/api",timeout:5e3});u.interceptors.request.use((function(e){return e.headers.platform="H5",e}),(function(e){return Promise.reject(e)})),u.interceptors.response.use((function(e){const t=e.data;return"很抱歉，图形验证码不正确"===t.message?((0,r.A)(t.message),Promise.reject(t.message)):t}),(function(e){return Promise.reject(e)}));class p{getCaptcha(e,t,s){return u.post("/captcha/sendSmsCaptcha",{form:{captchaCode:e,captchaKey:t,mobile:s}})}}var h=new p,d={name:"loginIndex",components:{Navbar:i.A},async created(){this.changeImgUrl()},data(){return{imgUrl:"",form:{captchaCode:"",captchaKey:"",mobile:""},smsCode:"",bool:!0,backNum:60,clearS:""}},methods:{async changeImgUrl(){const e=await l.changeImgUrl();this.imgUrl=e.data.base64,this.form.captchaKey=e.data.key},async getCaptcha(){this.voidFn()&&((0,r.A)("发送成功,请注意查收"),(0,r.A)("验证码为246810"),this.bool=!1,this.clearS=setInterval((()=>{this.backNum<=0&&(clearInterval(this.clearS),this.bool=!0,this.backNum=60),this.backNum--}),1e3),await h.getCaptcha(this.form.captchaCode,this.form.captchaKey,this.form.mobile))},async login(){if(!this.voidFn())return;if(!/^\d{6}$/.test(this.smsCode))return void(0,r.A)("请输入正确的验证码");const e=await l.login({form:{smsCode:this.smsCode,mobile:this.form.mobile,isParty:!1,partyData:{}}});(0,r.A)("登录成功"),this.$store.commit("user/cmUserInfo",e.data),console.log(this.$store.state.loginToUrl),this.$router.replace(this.$store.state.loginToUrl)},voidFn(){return/^1[2-9]\d{9}$/.test(this.form.mobile)?!!/^\w{4}$/.test(this.form.captchaCode)||((0,r.A)("请输入正确的图形验证码"),!1):((0,r.A)("请输入正确的手机号"),!1)}},beforeDestroy(){clearInterval(this.clearS),this.bool=!0,this.backNum=60}},f=d,g=s(1656),v=(0,g.A)(f,a,o,!1,null,"cde51a4a",null),b=v.exports},5720:function(e,t,s){s(9704);var a=s(1981),o=s(8355);const r=o.A.create({baseURL:"http://smart-shop.itheima.net/index.php?s=/api",timeout:5e3});r.interceptors.request.use((function(e){return a.A.loading({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),e.headers.platform="H5",e}),(function(e){return Promise.reject(e)})),r.interceptors.response.use((function(e){const t=e.data;return 200!==t.status?((0,a.A)(t.message),Promise.reject(t.message)):(a.A.clear(),t)}),(function(e){return"timeout of 5000ms exceeded"===e.message?(0,a.A)("请求超时"):Promise.reject(e)})),t.A=r}}]);
//# sourceMappingURL=51.58e1f19a.js.map